// Определение подкатегории товара по его названию
// Порядок важен: более специфичные проверки идут первыми

const SUBCATEGORY_RULES = [
  // Игристые / шампанское — проверяем до цветовых, т.к. могут содержать "белое"
  { name: 'Экстра Драй', test: (n) => /экстра\s*драй|extra\s*dry/i.test(n) },
  { name: 'Брют', test: (n) => /брют|brut/i.test(n) },
  { name: 'Просекко', test: (n) => /просекко|prosecco/i.test(n) },
  { name: 'Асти', test: (n) => /асти|asti/i.test(n) },

  // Портвейн / вино ликёрное
  { name: 'Портвейн', test: (n) => /портвейн|ликерн|ликёрн/i.test(n) },

  // Кагор
  { name: 'Кагор', test: (n) => /кагор/i.test(n) },

  // Настойки
  { name: 'Настойки', test: (n) => /настойк/i.test(n) },

  // Розовое (до красного/белого, т.к. "розовое" — отдельная категория)
  { name: 'Розовое', test: (n) => /розов/i.test(n) },

  // Красное — порядок: полусладкое перед сладким, полусухое перед сухим
  { name: 'Красное полусладкое', test: (n) => /красн/i.test(n) && /полусладк/i.test(n) },
  { name: 'Красное полусухое', test: (n) => /красн/i.test(n) && /полусух/i.test(n) },
  { name: 'Красное сладкое', test: (n) => /красн/i.test(n) && /сладк/i.test(n) },
  { name: 'Красное сухое', test: (n) => /красн/i.test(n) && /сух/i.test(n) },

  // Белое — тот же порядок
  { name: 'Белое полусладкое', test: (n) => /бел/i.test(n) && /полусладк/i.test(n) },
  { name: 'Белое полусухое', test: (n) => /бел/i.test(n) && /полусух/i.test(n) },
  { name: 'Белое сладкое', test: (n) => /бел/i.test(n) && /сладк/i.test(n) },
  { name: 'Белое сухое', test: (n) => /бел/i.test(n) && /сух/i.test(n) },

  // Общие фолбэки по типу (если цвет не указан)
  { name: 'Полусладкое', test: (n) => /полусладк/i.test(n) },
  { name: 'Полусухое', test: (n) => /полусух/i.test(n) },
  { name: 'Сладкое', test: (n) => /сладк/i.test(n) && !/полусладк/i.test(n) },
  { name: 'Сухое', test: (n) => /сух/i.test(n) && !/полусух/i.test(n) },
];

export function detectSubcategory(productName) {
  if (!productName) return '';
  const name = productName.trim();
  for (const rule of SUBCATEGORY_RULES) {
    if (rule.test(name)) {
      return rule.name;
    }
  }
  return '';
}

// Все возможные подкатегории для фильтров
export const ALL_SUBCATEGORIES = [
  'Красное сухое',
  'Красное полусухое',
  'Красное полусладкое',
  'Красное сладкое',
  'Белое сухое',
  'Белое полусухое',
  'Белое полусладкое',
  'Белое сладкое',
  'Розовое',
  'Кагор',
  'Настойки',
  'Экстра Драй',
  'Брют',
  'Просекко',
  'Асти',
  'Полусладкое',
  'Полусухое',
  'Сладкое',
  'Сухое',
  'Портвейн',
];
